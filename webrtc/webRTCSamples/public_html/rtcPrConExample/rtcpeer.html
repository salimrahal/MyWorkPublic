<!DOCTYPE html>
<!--
http://www.html5rocks.com/en/tutorials/webrtc/basics/#toc-rtcpeerconnection:
TODO:
get user media
get local stream
create peer connection 1 ..
create peer connection 2..
make the streaming
ps: use webkitRTCPeerConnection for Chrome and opera
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div id='container'>

            <video id="video1" autoplay></video>
            <video id="video2"  autoplay></video>

            <button id="start" onclick="start()">Start</button>

            <script>
                //todo access user media
                navigator.getUserMedia = navigator.getUserMedia ||
                        navigator.webkitGetUserMedia ||
                        navigator.mozGetUserMedia ||
                        navigator.msGetUserMedia;

                //get video element
                //var video = document.querySelector("video");
                var video1 = document.getElementById("video1");
                var video2 = document.getElementById("video2");


                function errocallback(e) {
                    console.log("rejected..", e);
                }

                //echo back the video image to the user
                function successcallback(stream) {
                    console.log("successcallback.." + stream);
                    //video1.src = window.URL.createObjectURL(stream);
                    //video2.src = window.URL.createObjectURL(stream);            
                    //todo: make the call between the peers

                }
                
//+++++++++++++++++++Caller         
                function makeConnectionCaller(localstream) {
                    // servers is an optional config file (see TURN and STUN discussion below)
                    pc1 = new webkitRTCPeerConnection();
                    pc1.addStream(localstream);
                    pc1.createOffer(gotDescription1);
                    
                    
                }
                //...
                function gotDescription1(desc) {
                    pc1.setLocalDescription(desc);
                    trace("Offer from pc1 \n" + desc.sdp);
                    pc2.setRemoteDescription(desc);
                    pc2.createAnswer(gotDescription2);
                }


//++++++++++++++++++++++++++++++++Callee
                function makeConnectionCaller(localstream) {
                    pc2 = new webkitRTCPeerConnection();
                    pc2.onaddstream = gotRemoteStream;
                }

//...
                function gotRemoteStream(e) {
                    video2.src = URL.createObjectURL(e.stream);
                }




                function start() {
                    //invoke get usermedia
                    navigator.getUserMedia({video: true, audio: true}, successcallback, errocallback);
                }

            </script>
        </div>
    </body>
</html>
